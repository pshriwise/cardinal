# Converting CSG to CAD Geometry for Multiphysics

In this tutorial, you will learn how to:

- Convert OpenMC CSG-based models to DAGMC using the Coreform Cubit CSG-to-CAD converter
- Perform multiphysics feedback on a portion of the OpenMC model by coupling to finite element heat conduction
- Run hybrid CSG + DAGMC OpenMC models with Cardinal

To access this tutorial,

```
cd cardinal/tutorials/csg_to_cad
```

This tutorial also requires you to download
some mesh files from Box. Please download the files
from the `csg_to_cad` folder [here](https://anl.app.box.com/folder/290460582816)
and place these files within `tutorials/csg_to_cad`.

!alert! note title=DAGMC build
To run this tutorial, you need to have built Cardinal with DAGMC support enabled, by setting
`export ENABLE_DAGMC=true`.
!alert-end!

## Geometry and Computational Models

This model consists of a simplified version of the KRUSTY reactor.

## Converting CSG to CAD using Coreform Cubit

The [OpenMC CAD adapter](https://github.com/openmc-dev/openmc_cad_adapter)
provides the capability to convert OpenMC cells to CAD parts in the form of a
Cubit journal file that can be imported into Cubit. These CAD models can then be
exported to various other CAD formats supported by Cubit (ACIS, IGES, STEP,
etc.) or parts can be meshed for use in other simulations -- as is the case in
this tutorial.

OpenMC provides a plotting utility, which is useful for exploring CSG models,
but it is limited to axis-aligned slices of the geometry. CAD and meshing
utilities commonly support interactive rendering of parts, which is useful for
debugging geometry problems as well as verifying the shape and/or placement of
neutronics cells.

To generate a journal file of the KRUSTY model provided here with the CAD adapter,
run the following command:

```
openmc_to_cad model.xml -w 1000 1000 1000 -c 1
```

This will produce two files, `openmc.jou` and `openmc_cell1.jou`, that contain
the entire KRUSTY model and cell 1, the fuel region, respectively. It is
interesting to view the full model in CAD, but we will only need the first cell
for the purposes of this tutorial.

To open and import the full model in to Cubit, select the "Play journal file" button

!media cubit_play_journal.png
  id=cubit_play
  style=width:20%

and select the `openmc.jou` generated by the `openmc_to_cad` program above.

The model should then appear in Cubit

!media krusty_full_model_cubit.png
  id=krusty_full
  style=width:40%





## Multiphysics Coupling

### MOOSE Heat Conduction

### OpenMC Neutron Transport

## Execution and Postprocessing

To run the coupled calculation,

```
mpiexec -np 2 cardinal-opt -i openmc.i --n-threads=2
```

This will run both MOOSE and OpenMC with 2 MPI processes and 2 OpenMP threads per rank.
To run the simulation faster, you can increase the parallel processes/threads, or
simply decrease the number of particles used in OpenMC.
When the simulation has completed, you will have created a number of different output files:
